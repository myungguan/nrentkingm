/**
 * Created by Sanggoo on 2017-06-29.
 */
$(function(){var a=$("#searchWrap"),e=$("#searchMap"),n=a.find("#searchForm"),t=a.find("#reservationForm"),r=a.find(".map-wrap"),i=r.find(".map-search-wrap"),o=r.find(".map-point-wrap"),s=$(".list-search-wrap"),d=$(".list-content-wrap"),p=d.find(".list-scroll-inner"),l=p.find(".list-scroll-content");window.scrollTarget=isMobile?$(window):p;var c=new daum.maps.services.Geocoder,u=new daum.maps.services.Places;window.searchMap={dom:e[0],map:null,center:null,bounds:null,timeout:null,pickupMarker:null,returnMarker:null,pickupReturnMarker:null,searchMarker:null,rentshopMarker:null},window.listItemOffset=[];var m=0;$(document).on("click",".panToPosition",function(a){a.preventDefault(0);var e=$(this),n=e.data("lat"),t=e.data("lng");o.removeClass("on"),searchMap.center=new daum.maps.LatLng(n,t),searchMap.map.panTo(searchMap.center)}).on("resetList","#searchForm",function(e){e.stopPropagation(),a.data("detail",!1),a.removeClass("filter"),scrollTarget.scrollTop(0),n.data("finished",!1),l.removeClass("finished"),n.find('input[name="totalItem"]').val(20),n.find('input[name="currentItem"]').val(0),n.find('input[name="itemTo"]').val(19)}).on("submit","#searchForm",function(e){if(e.preventDefault(),!n.data("finished")&&!n.data("running")){var t=!1;n.data("running",!0);var r=n.find('input[name="totalItem"]'),i=n.find('input[name="currentItem"]'),o=n.find('input[name="itemTo"]'),p=parseInt(r.val()),c=parseInt(i.val()),u=parseInt(o.val());if(u>=p&&(u=p-1,o.val(u)),0==c){t=!0,d.showLoading();var m=parseInt(a.find('input[name="searchCount"]').val());a.find('input[name="searchCount"]').val(m+1)}n.find('input[name="colorQuery"]').val($.trim(s.find('input[name="color"]').val())),n.find('input[name="companyQuery"]').val($.trim(s.find('input[name="company"]').val())),n.find('input[name="modelQuery"]').val($.trim(s.find('input[name="model"]').val())),$.get("/rent/search_list.php",n.serializeArray()).done(function(e){if(0==c){window.listItemOffset=[],l.find(".page").remove();var t=d.find(".distance-info")}l.find(".loading").before(e),l.find(".page:not(.init)").trigger("init"),l.parents(".scrollWrap").trigger("resizeScrollBar"),p=parseInt(r.val()),0==c&&t.find(".info").html('검색업체: <span class="num">'+a.data("rentshopDetailLength").numberFormat(0)+'</span>, 예약가능 차량: <span class="num">'+p.numberFormat(0)+"</span>"),c+=20,u+=20,c>=p&&(n.data("finished",!0),l.addClass("finished")),i.val(c),o.val(u),p<1?l.addClass("no-item"):l.removeClass("no-item")}).complete(function(){t&&d.hideLoading(),n.data("running",!1)})}}).on("reset","#searchForm",function(a){a.stopPropagation(),n.find('input[name="ptype"]').val(""),n.find('input[name="insu"]').val(""),n.find('input[name="modelQuery"]').val(""),n.find('input[name="model"]').val(""),n.find('input[name="fuel"]').val(""),n.find('input[name="option"]').val(""),n.find('input[name="outdate"]').val(""),n.find('input[name="colorQuery"]').val(""),n.find('input[name="color"]').val(""),n.find('input[name="companyQuery"]').val(""),n.find('input[name="company"]').val(""),n.find('input[name="nosmoke"]').val("N"),n.trigger("resetList"),n.submit()}).on("setListLayout","#searchWrap",function(e){e.stopPropagation(),a.addClass("list").removeClass("re-search"),$("header").removeClass("no-shadow"),setTimeout(function(){searchMap.map.relayout(),searchMap.bounds?searchMap.map.setBounds(searchMap.bounds):searchMap.map.panTo(searchMap.center)},400)}).on("setAddress","#searchWrap",function(e,t){var r=$("#pickupAddr"),i=$("#returnAddr"),o=$("#searchAddr"),s="",p=null,l="",c=null,u=null,f=null;if(void 0===t)return!1;if(void 0!==t.search)n.find('input[name="searchLatLng"]').val(t.coord.getLat()+","+t.coord.getLng()),searchMap.searchMarker&&($("#marker"+searchMap.searchMarker.idx).addClass("off"),p=searchMap.searchMarker,setTimeout(function(){p.setMap(null)},300),searchMap.searchMarker=null),l="검색위치",o.html('<a href="#panToPosition" class="panToPosition" data-lat="'+t.coord.getLat()+'" data-lng="'+t.coord.getLng()+'">'+t.search+"</a>"),c='<div class="marker" id="marker'+ ++m+'"><div class="tooltip top"><div class="tooltip-arrow"></div><div class="tooltip-inner">'+l+"</div></div></div>",u=new daum.maps.CustomOverlay({position:t.coord,content:c,yAnchor:1}),u.idx=m,searchMap.searchMarker=u,u.setMap(searchMap.map),f=$("#marker"+m),setTimeout(function(){f.addClass("on")},100),n.find('input[name="distance"]').val(-1),n.find('input[name="pickupAddr"]').val(t.search),n.find('input[name="returnAddr"]').val(t.search),d.find(".delivery-info .search-addr").text(t.search),a.trigger("search");else if(void 0===t.pickup&&void 0===t.pickupReturn||(n.find('input[name="searchLatLng"]').val(t.coord.getLat()+","+t.coord.getLng()),searchMap.pickupMarker&&($("#marker"+searchMap.pickupMarker.idx).addClass("off"),p=searchMap.pickupMarker,setTimeout(function(){p.setMap(null)},300),searchMap.pickupMarker=null)),void 0===t.return&&void 0===t.pickupReturn||searchMap.returnMarker&&($("#marker"+searchMap.returnMarker.idx).addClass("off"),p=searchMap.returnMarker,setTimeout(function(){p.setMap(null)},300),searchMap.returnMarker=null),searchMap.pickupReturnMarker&&($("#marker"+searchMap.pickupReturnMarker.idx).addClass("off"),p=searchMap.pickupReturnMarker,setTimeout(function(){p.setMap(null)},300),searchMap.pickupReturnMarker=null,void 0!==t.pickup&&(i.text("지도를 움직여 픽업/반납 위치를 선택해 주세요"),a.data("return",!1).data("returnAddr","")),void 0!==t.return&&(r.text("지도를 움직여 픽업/반납 위치를 선택해 주세요"),a.data("pickup",!1).data("pickupAddr",""))),void 0!==t.pickup&&(l="픽업위치",r.html('<a href="#panToPosition" class="panToPosition" data-lat="'+t.coord.getLat()+'" data-lng="'+t.coord.getLng()+'">'+t.pickup+"</a>"),s="pickupMarker",a.data("pickup",!0).data("pickupAddr",t.pickup)),void 0!==t.return&&(l="반납위치",i.html('<a href="#panToPosition" class="panToPosition" data-lat="'+t.coord.getLat()+'" data-lng="'+t.coord.getLng()+'">'+t.return+"</a>"),s="returnMarker",a.data("return",!0).data("returnAddr",t.return)),void 0!==t.pickupReturn&&(l="검색위치",r.html('<a href="#panToPosition" class="panToPosition" data-lat="'+t.coord.getLat()+'" data-lng="'+t.coord.getLng()+'">'+t.pickupReturn+"</a>"),i.html('<a href="#panToPosition" class="panToPosition" data-lat="'+t.coord.getLat()+'" data-lng="'+t.coord.getLng()+'">'+t.pickupReturn+"</a>"),s="pickupReturnMarker",a.data("pickup",!0).data("pickupAddr",t.pickupReturn),a.data("return",!0).data("returnAddr",t.pickupReturn)),c='<div class="marker" id="marker'+ ++m+'"><div class="tooltip top"><div class="tooltip-arrow"></div><div class="tooltip-inner">'+l+"</div></div></div>",u=new daum.maps.CustomOverlay({position:t.coord,content:c,yAnchor:1}),u.idx=m,searchMap[s]=u,u.setMap(searchMap.map),f=$("#marker"+m),setTimeout(function(){f.addClass("on")},100),a.data("return")&&a.data("pickup")){var h=a.data("pickupAddr"),v=a.data("returnAddr");n.find('input[name="pickupAddr"]').val(h),n.find('input[name="returnAddr"]').val(v),n.find('input[name="distance"]').val(-1),d.find(".delivery-info .pickup-addr").text(h),d.find(".delivery-info .return-addr").text(v),a.data("pickup",!1).data("return",!1),a.trigger("search")}}).on("search","#searchWrap",function(e){e.stopPropagation(),n.trigger("resetList"),$.getJSON("/rent/search_rentshop.php",n.serializeArray()).done(function(e){a.hasClass("list")||a.trigger("setListLayout"),n.find('input[name="rentshopList"]').val(e.rentshopList);var t=e.distanceList,r=e.distance,i=d.find(".distance-info"),o=e.rentshopDetail;if(i.find("button").remove(),t)for(var s=0;s<t.length;s++){var p="";r==t[s]&&(p="on"),i.append('<button class="'+p+'" data-distance="'+s+'">'+(t[s]/1e3).numberFormat(0)+"km</button>")}a.data("rentshopDetailLength",o.length),a.data("rentshopDetail",o).trigger("setRentshopMarker",{rentshop:o}),n.find('input[name="distanceM"]').val(r),n.submit()}).complete(function(){})}).on("submit",".map-search-wrap form",function(a){a.preventDefault();var e=$(this),n=e.find("input"),t=n.val();i.removeClass("error"),c.addr2coord(t,function(a,r){a===daum.maps.services.Status.OK?(window.searchMap.center=new daum.maps.LatLng(r.addr[0].lat,r.addr[0].lng),window.searchMap.map.getLevel()>5&&window.searchMap.map.setLevel(5),window.searchMap.map.panTo(window.searchMap.center),e.tooltip("hide"),o.addClass("on"),n.blur()):u.keywordSearch(t,function(a,t){a===daum.maps.services.Status.OK?(window.searchMap.center=new daum.maps.LatLng(t.places[0].latitude,t.places[0].longitude),window.searchMap.map.getLevel()>5&&window.searchMap.map.setLevel(5),window.searchMap.map.panTo(window.searchMap.center),e.tooltip("hide"),o.addClass("on"),n.blur()):(e.tooltip("show"),i.addClass("error").find(".tooltip-inner").text("검색 결과를 찾을 수 없습니다."))})})}).on("click",".map-point-wrap button",function(){var e=$(this),n=searchMap.map.getCenter();c.coord2detailaddr(n,function(t,r){if(t===daum.maps.services.Status.OK){o.removeClass("on");var i="";r[0].roadAddress.name?i=r[0].roadAddress.name:r[0].jibunAddress.name&&(i=r[0].jibunAddress.name);var s={coord:n};e.hasClass("pickup")?s.pickup=i:e.hasClass("return")?s.return=i:e.hasClass("pickup-return")?s.pickupReturn=i:s.search=i,a.trigger("setAddress",s)}})}).on("click",".list-search-wrap button.option, .list-content-wrap .grade-info button.option",function(){var a=$(this);a.toggleClass("on");var e=a.hasClass("on"),t=a.data("name"),r=a.data("value"),i=n.find('input[name="'+t+'"]'),o=i.val();e?o+="|"+r+"|":o=o.replace("|"+r+"|",""),i.val(o)}).on("click",'.list-search-wrap input[name="nosmoke"]',function(){n.find('input[name="nosmoke"]').val($(this).val())}).on("click",".list-search-wrap .reset-search",function(){s.find('button.option[data-name="ptype"]').removeClass("on"),s.find('button.option[data-name="insu"]').removeClass("on"),s.find('input[name="model"]').val(""),s.find('button.option[data-name="model"]').removeClass("on"),s.find('button.option[data-name="fuel"]').removeClass("on"),s.find('button.option[data-name="option"]').removeClass("on"),s.find('button.option[data-name="model"]').removeClass("on"),s.find('input[name="color"]').val(""),s.find('button.option[data-name="color"]').removeClass("on"),s.find('input[name="company"]').val(""),s.find('button.option[data-name="company"]').removeClass("on"),s.find('input[name="nosmoke"]')[0].checked=!0,n.trigger("reset")}).on("click",".list-content-wrap a.delivery-info, .list-content-wrap a.re-search",function(n){n.preventDefault(),a.removeClass("list detail").addClass("re-search"),$("header").addClass("no-shadow"),$("body").removeClass("header-hide"),searchMap.searchMarker&&(searchMap.center=searchMap.searchMarker.getPosition(),e.find(".marker.rentshop-info").removeClass("on").trigger("mouseleave")),setTimeout(function(){searchMap.map.relayout(),searchMap.map.panTo(searchMap.center),a.trigger("setAddress")},400)}).on("reveal",".list-content-wrap .list-scroll .page li.item",function(a){a.stopPropagation();var e=$(this);e.addClass("reveal"),setTimeout(function(){e.find(".info .numberAnimation").trigger("animate")},200)}).on("click",".list-content-wrap .distance-info button",function(){var e=$(this);n.find('input[name="distance"]').val(e.data("distance")),a.trigger("search")}).on("click",".list-content-wrap a.filter",function(e){e.preventDefault(),a.toggleClass("filter"),clearTimeout(searchMap.timeout),searchMap.timeout=setTimeout(function(){searchMap.map.relayout(),searchMap.map.setCenter(searchMap.center)},300)}).on("click",".list-content-wrap .list-scroll .page li.item a.item-link",function(e){e.stopPropagation(),e.preventDefault();var n=$(this),t=n.parent();t.hasClass("on")?(t.removeClass("on active"),scrollTarget.data("onScroll",-1)):(scrollTarget.data("onScroll",scrollTarget.scrollTop()),l.find("li.item.on").removeClass("on active").find(".button-area .numberAnimation").data("current",0).text(0),t.addClass("on active"),setTimeout(function(){t.find(".button-area .numberAnimation").trigger("animate")},200),setTimeout(function(){t.removeClass("active")},2e3)),isMobile||t.trigger("goRentshop"),a.removeClass("filter")}).on("click",".list-content-wrap .list-scroll .page li a.reservation",function(a){if(a.preventDefault(),!t.data("running")){t.data("running",!0);var e=$(this),r=e.attr("href").split("#")[1],i=e.data("insu"),o=n.find('input[name="pickupAddr"]').val(),s=n.find('input[name="returnAddr"]').val();t.find('input[name="vehicle_idx"]').val(r),void 0!==i?t.find('input[name="insu"]').val(i):t.find('input[name="insu"]').val(""),t.find('input[name="addr"]').val(o),t.find('input[name="raddr"]').val(s),$.getJSON(t.attr("action"),t.serializeArray()).done(function(a){if(a.num<1)return void alert(a.err);location.href="/rent/payment.php?idx="+a.idx}).complete(function(){t.data("running",!1)})}}).on("keyup",".list-search-wrap .autocomplete input",function(a){13==a.keyCode&&n.trigger("resetList").submit()}).on("click",".list-search-wrap .autocomplete button",function(){n.trigger("resetList").submit()}),scrollTarget.on("scroll",function(){var e=scrollTarget.outerHeight(),t=l.outerHeight(),r=scrollTarget.scrollTop(),i=scrollTarget.data("onScroll");if(void 0!==i&&i>-1&&Math.abs(r-i)>250){var o=l.find("li.item.on").removeClass("on active");isMobile||o.trigger("goRentshop"),scrollTarget.data("onScroll",-1)}a.hasClass("list")&&r+e>t-260&&n.submit();for(var s=[],d=0;d<window.listItemOffset.length;d++)r+e>window.listItemOffset[d].offset&&(s.push(window.listItemOffset[d].$item),window.listItemOffset.splice(d,1),d--);for(d=0;d<s.length;d++)s[d].trigger("reveal")}),addLocationTask(function(a){$("body").addClass("ptype2"),setTimeout(function(){searchMap.center=new daum.maps.LatLng(a.lat,a.lng),searchMap.map=new daum.maps.Map(searchMap.dom,{center:searchMap.center,level:5});var e=new daum.maps.ZoomControl;searchMap.map.addControl(e,daum.maps.ControlPosition.BOTTOMRIGHT),daum.maps.event.addListener(searchMap.map,"dragstart",function(){o.removeClass("on")}),daum.maps.event.addListener(searchMap.map,"dragend",function(){o.addClass("on"),searchMap.center=this.getCenter()}),daum.maps.event.addListener(searchMap.map,"click",function(a){o.addClass("on"),searchMap.center=a.latLng,searchMap.map.panTo(searchMap.center)}),setTimeout(function(){o.addClass("on")},200)},300)})});
//# sourceMappingURL=rentking.search.min.js.map
